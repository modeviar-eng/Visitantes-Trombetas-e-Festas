<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Gest√£o de Presen√ßa</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f3f4f6; }
        .loader {
            border: 3px solid #f3f3f3; border-top: 3px solid #4f46e5;
            border-radius: 50%; width: 20px; height: 20px;
            animation: spin 1s linear infinite; display: none;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        /* Transi√ß√£o suave para abas */
        .tab-content { display: none; animation: fadeIn 0.3s; }
        .tab-content.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        /* Estilos espec√≠ficos para a nova aba de resumo */
        .card-resumo {
            background-color: #fff;
            padding: 1rem;
            border-radius: 0.5rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.1);
        }
    </style>
</head>
<body class="min-h-screen flex flex-col items-center py-8 px-4">

    <div class="bg-white p-1 rounded-lg shadow-xl mb-6 flex space-x-1 w-full max-w-4xl">
        <button onclick="switchTab('cadastroVisitante')" id="tab-cadastroVisitante" class="flex-1 py-2 px-4 rounded-md text-sm font-medium bg-indigo-100 text-indigo-700 transition-colors">
            üìù Cadastrar Visitante
        </button>
        <button onclick="switchTab('cadastroMembro')" id="tab-cadastroMembro" class="flex-1 py-2 px-4 rounded-md text-sm font-medium text-gray-500 hover:text-gray-700 transition-colors">
            üë§ Cadastrar Membro
        </button>
        <button onclick="switchTab('historicoVisitantes')" id="tab-historicoVisitantes" class="flex-1 py-2 px-4 rounded-md text-sm font-medium text-gray-500 hover:text-gray-700 transition-colors">
            üìÇ Hist√≥rico Visitantes
        </button>
        <button onclick="switchTab('historicoGeral')" id="tab-historicoGeral" class="flex-1 py-2 px-4 rounded-md text-sm font-medium text-gray-500 hover:text-gray-700 transition-colors">
            üìä Hist√≥rico Geral
        </button>
    </div>

    <div id="view-cadastroVisitante" class="tab-content active w-full max-w-2xl bg-white p-6 rounded-xl shadow-lg border border-gray-100">
        <h1 class="text-2xl font-bold text-center text-gray-800 mb-2">Novo Visitante</h1>
        <p class="text-center text-gray-500 mb-6">Ficha de registro para quem est√° nos visitando.</p>

        <form id="formularioVisitante" class="space-y-5">
             <div class="border-b border-indigo-200 pb-4">
                <label class="block text-sm font-bold text-indigo-700 mb-2">üìç Igreja de Lota√ß√£o <span class="text-red-500">*</span></label>
                <div class="flex flex-wrap gap-3">
                    <label class="border rounded-md p-3 flex items-center justify-center cursor-pointer hover:bg-indigo-50 transition peer-checked:border-indigo-600">
                        <input type="radio" name="igreja_visitante" value="Centro - A√ßailandia" required class="sr-only peer"> 
                        <span class="text-sm font-medium text-gray-600 peer-checked:text-indigo-700 peer-checked:font-bold">Centro - A√ßailandia</span>
                    </label>
                    <label class="border rounded-md p-3 flex items-center justify-center cursor-pointer hover:bg-indigo-50 transition peer-checked:border-indigo-600">
                        <input type="radio" name="igreja_visitante" value="Itinga" required class="sr-only peer"> 
                        <span class="text-sm font-medium text-gray-600 peer-checked:text-indigo-700 peer-checked:font-bold">Itinga</span>
                    </label>
                    <label class="border rounded-md p-3 flex items-center justify-center cursor-pointer hover:bg-indigo-50 transition peer-checked:border-indigo-600">
                        <input type="radio" name="igreja_visitante" value="Dom Eliseu" required class="sr-only peer"> 
                        <span class="text-sm font-medium text-gray-600 peer-checked:text-indigo-700 peer-checked:font-bold">Dom Eliseu</span>
                    </label>
                </div>
            </div>
            <div>
                <label class="block text-sm font-medium text-gray-700">Nome Completo <span class="text-red-500">*</span></label>
                <input type="text" id="nome_visitante" required class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 outline-none transition">
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700">WhatsApp</label>
                    <input type="tel" id="telefone_visitante" placeholder="(XX) 9XXXX-XXXX" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Sexo</label>
                    <div class="flex space-x-4 mt-2">
                        <label class="inline-flex items-center cursor-pointer">
                            <input type="radio" name="sexo_visitante" value="Masculino" class="form-radio text-indigo-600">
                            <span class="ml-2 text-gray-600">Masculino</span>
                        </label>
                        <label class="inline-flex items-center cursor-pointer">
                            <input type="radio" name="sexo_visitante" value="Feminino" class="form-radio text-indigo-600">
                            <span class="ml-2 text-gray-600">Feminino</span>
                        </label>
                    </div>
                </div>
            </div>

            <div>
                <label class="block text-sm font-medium text-gray-700">Endere√ßo (Rua, Bairro, Cidade)</label>
                <input type="text" id="endereco_visitante" placeholder="Ex: Rua A, Centro" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none">
            </div>

            <div>
                <label class="block text-sm font-medium text-gray-700">Quem te convidou?</label>
                <input type="text" id="convidado_por_visitante" placeholder="Digite o nome do membro" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none">
            </div>

            <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Faixa Et√°ria</label>
                <div class="grid grid-cols-3 gap-3 sm:grid-cols-4 lg:grid-cols-6">
                    <label class="border rounded-md p-2 flex items-center justify-center cursor-pointer hover:bg-gray-50">
                        <input type="radio" name="faixa_etaria_visitante" value="0-3" class="sr-only peer"> <span class="text-xs text-gray-600 peer-checked:text-indigo-600 peer-checked:font-bold">0 a 3</span>
                    </label>
                    <label class="border rounded-md p-2 flex items-center justify-center cursor-pointer hover:bg-gray-50">
                        <input type="radio" name="faixa_etaria_visitante" value="3-7" class="sr-only peer"> <span class="text-xs text-gray-600 peer-checked:text-indigo-600 peer-checked:font-bold">3 a 7</span>
                    </label>
                    <label class="border rounded-md p-2 flex items-center justify-center cursor-pointer hover:bg-gray-50">
                        <input type="radio" name="faixa_etaria_visitante" value="7-11" class="sr-only peer"> <span class="text-xs text-gray-600 peer-checked:text-indigo-600 peer-checked:font-bold">7 a 11</span>
                    </label>
                    <label class="border rounded-md p-2 flex items-center justify-center cursor-pointer hover:bg-gray-50">
                        <input type="radio" name="faixa_etaria_visitante" value="11-15" class="sr-only peer"> <span class="text-xs text-gray-600 peer-checked:text-indigo-600 peer-checked:font-bold">11 a 15</span>
                    </label>
                    <label class="border rounded-md p-2 flex items-center justify-center cursor-pointer hover:bg-gray-50">
                        <input type="radio" name="faixa_etaria_visitante" value="15-30" class="sr-only peer"> <span class="text-xs text-gray-600 peer-checked:text-indigo-600 peer-checked:font-bold">15 a 30</span>
                    </label>
                    <label class="border rounded-md p-2 flex items-center justify-center cursor-pointer hover:bg-gray-50">
                        <input type="radio" name="faixa_etaria_visitante" value="30-60" class="sr-only peer"> <span class="text-xs text-gray-600 peer-checked:text-indigo-600 peer-checked:font-bold">30 a 60</span>
                    </label>
                    <label class="border rounded-md p-2 flex items-center justify-center cursor-pointer hover:bg-gray-50">
                        <input type="radio" name="faixa_etaria_visitante" value="60+" class="sr-only peer"> <span class="text-xs text-gray-600 peer-checked:text-indigo-600 peer-checked:font-bold">60+</span>
                    </label>
                </div>
            </div>

            <div class="bg-indigo-50 p-3 rounded-lg border border-indigo-100">
                <label class="block text-sm font-semibold text-indigo-900 mb-1">Gostaria de receber uma visita?</label>
                <div class="flex space-x-6 mt-2">
                    <label class="inline-flex items-center cursor-pointer">
                        <input type="radio" name="receber_visita_visitante" value="Sim" class="form-radio text-indigo-600 w-4 h-4">
                        <span class="ml-2 text-gray-700 font-medium">Sim</span>
                    </label>
                    <label class="inline-flex items-center cursor-pointer">
                        <input type="radio" name="receber_visita_visitante" value="N√£o" class="form-radio text-gray-400 w-4 h-4">
                        <span class="ml-2 text-gray-600">N√£o</span>
                    </label>
                </div>
            </div>
            
            <div>
                <label for="experiencia_visitante" class="block text-sm font-medium text-gray-700">Experi√™ncia com o evento (Opcional)</label>
                <textarea id="experiencia_visitante" rows="3" placeholder="Seus coment√°rios ou pedidos de ora√ß√£o."
                    class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none"></textarea>
            </div>

            <button type="submit" id="submitButtonVisitante" class="w-full py-3 px-4 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg font-semibold shadow-md transition duration-200 flex justify-center items-center">
                <span>Confirmar Presen√ßa de Visitante</span>
                <div id="loaderVisitante" class="loader ml-3"></div>
            </button>
            <div id="feedbackMessageVisitante" class="hidden p-3 rounded-md text-sm text-center font-medium"></div>
        </form>
    </div>

    <div id="view-cadastroMembro" class="tab-content w-full max-w-2xl bg-white p-6 rounded-xl shadow-lg border border-gray-100 hidden">
        <h1 class="text-2xl font-bold text-center text-gray-800 mb-2">Novo Membro</h1>
        <p class="text-center text-gray-500 mb-6">Registro para contabilizar a presen√ßa de membros.</p>

        <form id="formularioMembro" class="space-y-5">
            <div class="border-b border-green-200 pb-4">
                <label class="block text-sm font-bold text-green-700 mb-2">üìç Igreja de Lota√ß√£o <span class="text-red-500">*</span></label>
                <div class="flex flex-wrap gap-3">
                    <label class="border rounded-md p-3 flex items-center justify-center cursor-pointer hover:bg-green-50 transition peer-checked:border-green-600">
                        <input type="radio" name="igreja_membro" value="Centro - A√ßailandia" required class="sr-only peer"> 
                        <span class="text-sm font-medium text-gray-600 peer-checked:text-green-700 peer-checked:font-bold">Centro - A√ßailandia</span>
                    </label>
                    <label class="border rounded-md p-3 flex items-center justify-center cursor-pointer hover:bg-green-50 transition peer-checked:border-green-600">
                        <input type="radio" name="igreja_membro" value="Itinga" required class="sr-only peer"> 
                        <span class="text-sm font-medium text-gray-600 peer-checked:text-green-700 peer-checked:font-bold">Itinga</span>
                    </label>
                    <label class="border rounded-md p-3 flex items-center justify-center cursor-pointer hover:bg-green-50 transition peer-checked:border-green-600">
                        <input type="radio" name="igreja_membro" value="Dom Eliseu" required class="sr-only peer"> 
                        <span class="text-sm font-medium text-gray-600 peer-checked:text-green-700 peer-checked:font-bold">Dom Eliseu</span>
                    </label>
                </div>
            </div>
            <div>
                <label class="block text-sm font-medium text-gray-700">Nome Completo <span class="text-red-500">*</span></label>
                <input type="text" id="nome_membro" required class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500 outline-none transition">
            </div>

            <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">Sexo</label>
                <div class="flex space-x-4 mt-2">
                    <label class="inline-flex items-center cursor-pointer">
                        <input type="radio" name="sexo_membro" value="Masculino" class="form-radio text-green-600">
                        <span class="ml-2 text-gray-600">Masculino</span>
                    </label>
                    <label class="inline-flex items-center cursor-pointer">
                        <input type="radio" name="sexo_membro" value="Feminino" class="form-radio text-green-600">
                        <span class="ml-2 text-gray-600">Feminino</span>
                    </label>
                </div>
            </div>
            
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Faixa Et√°ria</label>
                <div class="grid grid-cols-3 gap-3 sm:grid-cols-4 lg:grid-cols-6">
                    <label class="border rounded-md p-2 flex items-center justify-center cursor-pointer hover:bg-gray-50">
                        <input type="radio" name="faixa_etaria_membro" value="0-3" class="sr-only peer"> <span class="text-xs text-gray-600 peer-checked:text-green-600 peer-checked:font-bold">0 a 3</span>
                    </label>
                    <label class="border rounded-md p-2 flex items-center justify-center cursor-pointer hover:bg-gray-50">
                        <input type="radio" name="faixa_etaria_membro" value="3-7" class="sr-only peer"> <span class="text-xs text-gray-600 peer-checked:text-green-600 peer-checked:font-bold">3 a 7</span>
                    </label>
                    <label class="border rounded-md p-2 flex items-center justify-center cursor-pointer hover:bg-gray-50">
                        <input type="radio" name="faixa_etaria_membro" value="7-11" class="sr-only peer"> <span class="text-xs text-gray-600 peer-checked:text-green-600 peer-checked:font-bold">7 a 11</span>
                    </label>
                    <label class="border rounded-md p-2 flex items-center justify-center cursor-pointer hover:bg-gray-50">
                        <input type="radio" name="faixa_etaria_membro" value="11-15" class="sr-only peer"> <span class="text-xs text-gray-600 peer-checked:text-green-600 peer-checked:font-bold">11 a 15</span>
                    </label>
                    <label class="border rounded-md p-2 flex items-center justify-center cursor-pointer hover:bg-gray-50">
                        <input type="radio" name="faixa_etaria_membro" value="15-30" class="sr-only peer"> <span class="text-xs text-gray-600 peer-checked:text-green-600 peer-checked:font-bold">15 a 30</span>
                    </label>
                    <label class="border rounded-md p-2 flex items-center justify-center cursor-pointer hover:bg-gray-50">
                        <input type="radio" name="faixa_etaria_membro" value="30-60" class="sr-only peer"> <span class="text-xs text-gray-600 peer-checked:text-green-600 peer-checked:font-bold">30 a 60</span>
                    </label>
                    <label class="border rounded-md p-2 flex items-center justify-center cursor-pointer hover:bg-gray-50">
                        <input type="radio" name="faixa_etaria_membro" value="60+" class="sr-only peer"> <span class="text-xs text-gray-600 peer-checked:text-green-600 peer-checked:font-bold">60+</span>
                    </label>
                </div>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700">Fun√ß√£o/Minist√©rio (Opcional)</label>
                    <input type="text" id="funcao_membro" placeholder="Ex: Di√°cono, L√≠der de Louvor, etc." class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 outline-none">
                </div>
                
                <div class="col-span-1">
                    <label class="block text-sm font-medium text-gray-700 mb-2">Grupo de Assist√™ncia (Opcional)</label>
                    <div class="flex space-x-3 mt-1">
                        <label class="inline-flex items-center cursor-pointer border rounded-md p-2 px-3 hover:bg-gray-50">
                            <input type="radio" name="grupo_assistencia_membro" value="Grupo 1" class="form-radio text-green-600">
                            <span class="ml-2 text-sm text-gray-600">Grupo 1</span>
                        </label>
                        <label class="inline-flex items-center cursor-pointer border rounded-md p-2 px-3 hover:bg-gray-50">
                            <input type="radio" name="grupo_assistencia_membro" value="Grupo 2" class="form-radio text-green-600">
                            <span class="ml-2 text-sm text-gray-600">Grupo 2</span>
                        </label>
                        <label class="inline-flex items-center cursor-pointer border rounded-md p-2 px-3 hover:bg-gray-50">
                            <input type="radio" name="grupo_assistencia_membro" value="Grupo 3" class="form-radio text-green-600">
                            <span class="ml-2 text-sm text-gray-600">Grupo 3</span>
                        </label>
                    </div>
                </div>
                </div>
            
            <button type="submit" id="submitButtonMembro" class="w-full py-3 px-4 bg-green-600 hover:bg-green-700 text-white rounded-lg font-semibold shadow-md transition duration-200 flex justify-center items-center">
                <span>Confirmar Presen√ßa de Membro</span>
                <div id="loaderMembro" class="loader ml-3 border-top-green"></div>
            </button>
            <div id="feedbackMessageMembro" class="hidden p-3 rounded-md text-sm text-center font-medium"></div>
        </form>
    </div>

    <div id="view-historicoVisitantes" class="tab-content w-full max-w-4xl bg-white p-6 rounded-xl shadow-lg border border-gray-100 hidden">
        <div class="flex justify-between items-center mb-6">
            <h2 class="text-xl font-bold text-gray-800">üìÇ Hist√≥rico de VISITANTES</h2>
            <button onclick="carregarHistoricoGeral(true)" class="text-sm text-indigo-600 hover:underline flex items-center">
                üîÑ Atualizar Lista
            </button>
        </div>

        <div class="bg-red-50 p-3 rounded-lg border border-red-200 mb-6">
            <label class="block text-sm font-bold text-red-700 mb-2">Selecione a Igreja para Visualizar o Hist√≥rico <span class="text-red-500">*</span></label>
            <div class="flex flex-wrap gap-3">
                <label class="border rounded-md p-3 flex items-center justify-center cursor-pointer hover:bg-gray-100 transition">
                    <input type="radio" name="filtro_igreja_visitante" value="Centro - A√ßailandia" onchange="carregarHistoricoVisitantes()" class="form-radio text-red-600"> 
                    <span class="ml-2 text-sm font-medium text-gray-700">Centro - A√ßailandia</span>
                </label>
                <label class="border rounded-md p-3 flex items-center justify-center cursor-pointer hover:bg-gray-100 transition">
                    <input type="radio" name="filtro_igreja_visitante" value="Itinga" onchange="carregarHistoricoVisitantes()" class="form-radio text-red-600"> 
                    <span class="ml-2 text-sm font-medium text-gray-700">Itinga</span>
                </label>
                <label class="border rounded-md p-3 flex items-center justify-center cursor-pointer hover:bg-gray-100 transition">
                    <input type="radio" name="filtro_igreja_visitante" value="Dom Eliseu" onchange="carregarHistoricoVisitantes()" class="form-radio text-red-600"> 
                    <span class="ml-2 text-sm font-medium text-gray-700">Dom Eliseu</span>
                </label>
            </div>
            <div id="avisoIgrejaVisitante" class="text-xs text-red-500 mt-2 font-medium">‚ö†Ô∏è Por favor, selecione uma igreja para carregar os dados.</div>
        </div>
        <div id="conteudoHistoricoVisitante" class="hidden">
            <div class="mb-6">
                <label class="block text-xs font-semibold text-gray-500 uppercase mb-1">Busca R√°pida (Nome ou Localidade)</label>
                <input type="text" id="buscaInputVisitante" oninput="aplicarFiltrosVisitantes()" placeholder="Digite um nome, bairro ou rua..." 
                        class="w-full p-2 border border-gray-300 rounded-md text-sm focus:ring-indigo-500 focus:border-indigo-500">
            </div>

            <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-4 mb-6 bg-gray-50 p-4 rounded-lg">
                <div>
                    <label class="block text-xs font-semibold text-gray-500 uppercase mb-1">1. Convidado Por</label>
                    <select id="filtroMembro" onchange="aplicarFiltrosVisitantes()" class="w-full p-2 border border-gray-300 rounded-md text-sm focus:ring-indigo-500">
                        <option value="">Todos</option>
                    </select>
                </div>
                <div>
                    <label class="block text-xs font-semibold text-gray-500 uppercase mb-1">2. Faixa Et√°ria</label>
                    <select id="filtroIdade" onchange="aplicarFiltrosVisitantes()" class="w-full p-2 border border-gray-300 rounded-md text-sm focus:ring-indigo-500">
                        <option value="">Todas</option>
                        <option value="0-3">0 a 3 anos</option><option value="3-7">3 a 7 anos</option><option value="7-11">7 a 11 anos</option>
                        <option value="11-15">11 a 15 anos</option><option value="15-30">15 a 30 anos</option><option value="30-60">30 a 60 anos</option>
                        <option value="60+">60 anos ou mais</option>
                    </select>
                </div>
                <div>
                    <label class="block text-xs font-semibold text-gray-500 uppercase mb-1">3. Sexo</label>
                    <select id="filtroSexoVisitante" onchange="aplicarFiltrosVisitantes()" class="w-full p-2 border border-gray-300 rounded-md text-sm focus:ring-indigo-500">
                        <option value="">Todos</option>
                        <option value="Masculino">Masculino</option>
                        <option value="Feminino">Feminino</option>
                        <option value="N√£o informado">N√£o informado</option>
                    </select>
                </div>
                <div>
                    <label class="block text-xs font-semibold text-gray-500 uppercase mb-1">4. Quer Visita?</label>
                    <select id="filtroVisita" onchange="aplicarFiltrosVisitantes()" class="w-full p-2 border border-gray-300 rounded-md text-sm focus:ring-indigo-500 font-medium text-indigo-700 bg-indigo-50">
                        <option value="">Todos</option>
                        <option value="Sim">‚úÖ Sim, quer visita</option>
                        <option value="N√£o">‚ùå N√£o</option>
                    </select>
                </div>
            </div>

            <div class="overflow-x-auto">
                <table class="min-w-full divide-y divide-gray-200">
                    <thead class="bg-gray-50">
                        <tr>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Nome / Contato</th>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Localidade</th>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Perfil</th>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Visita?</th>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Convidado Por</th>
                        </tr>
                    </thead>
                    <tbody id="tabelaCorpoVisitantes" class="bg-white divide-y divide-gray-200"></tbody>
                </table>
                <div id="loadingHistoricoVisitantes" class="text-center py-4 text-gray-500 hidden">Carregando dados...</div>
                <div id="semResultadosVisitantes" class="text-center py-4 text-gray-500 hidden">Nenhum visitante encontrado com esses filtros.</div>
            </div>
            
            <div class="mt-4 text-right text-xs text-gray-400">
                Visitantes listados: <span id="contadorTotalVisitantes" class="font-bold text-gray-700">0</span>
            </div>
        </div>
    </div>


    <div id="view-historicoGeral" class="tab-content w-full max-w-4xl bg-gray-50 p-6 rounded-xl shadow-lg border border-gray-100 hidden">
        <div class="flex justify-between items-center mb-6">
            <h2 class="text-xl font-bold text-gray-800">üìä Hist√≥rico Geral & Resumo</h2>
            <button onclick="carregarHistoricoGeral(true)" class="text-sm text-indigo-600 hover:underline flex items-center">
                üîÑ Atualizar Totais
            </button>
        </div>
        
         <div class="bg-red-50 p-3 rounded-lg border border-red-200 mb-6">
            <label class="block text-sm font-bold text-red-700 mb-2">Selecione a Igreja para Visualizar o Hist√≥rico <span class="text-red-500">*</span></label>
            <div class="flex flex-wrap gap-3">
                <label class="border rounded-md p-3 flex items-center justify-center cursor-pointer hover:bg-gray-100 transition">
                    <input type="radio" name="filtro_igreja_geral" value="Centro - A√ßailandia" onchange="carregarHistoricoGeral()" class="form-radio text-red-600"> 
                    <span class="ml-2 text-sm font-medium text-gray-700">Centro - A√ßailandia</span>
                </label>
                <label class="border rounded-md p-3 flex items-center justify-center cursor-pointer hover:bg-gray-100 transition">
                    <input type="radio" name="filtro_igreja_geral" value="Itinga" onchange="carregarHistoricoGeral()" class="form-radio text-red-600"> 
                    <span class="ml-2 text-sm font-medium text-gray-700">Itinga</span>
                </label>
                <label class="border rounded-md p-3 flex items-center justify-center cursor-pointer hover:bg-gray-100 transition">
                    <input type="radio" name="filtro_igreja_geral" value="Dom Eliseu" onchange="carregarHistoricoGeral()" class="form-radio text-red-600"> 
                    <span class="ml-2 text-sm font-medium text-gray-700">Dom Eliseu</span>
                </label>
            </div>
             <div id="avisoIgrejaGeral" class="text-xs text-red-500 mt-2 font-medium">‚ö†Ô∏è Por favor, selecione uma igreja para carregar os dados.</div>
        </div>
        <div id="conteudoHistoricoGeral" class="hidden">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                <div class="card-resumo bg-indigo-50 border-l-4 border-indigo-500">
                    <div class="text-sm font-medium text-indigo-600">Total Geral</div>
                    <div id="totalGeral" class="text-3xl font-bold text-gray-900">0</div>
                </div>
                <div class="card-resumo bg-blue-50 border-l-4 border-blue-500">
                    <div class="text-sm font-medium text-blue-600">Total Visitantes</div>
                    <div id="totalVisitantes" class="text-3xl font-bold text-gray-900">0</div>
                </div>
                <div class="card-resumo bg-green-50 border-l-4 border-green-500">
                    <div class="text-sm font-medium text-green-600">Total Membros</div>
                    <div id="totalMembros" class="text-3xl font-bold text-gray-900">0</div>
                </div>
            </div>

            <div class="bg-white p-4 rounded-lg shadow-sm">
                <h3 class="text-lg font-semibold text-gray-700 mb-3 border-b pb-2">Lista Unificada</h3>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                    <div class="md:col-span-2">
                        <label class="block text-xs font-semibold text-gray-500 uppercase mb-1">Busca R√°pida (Nome ou Contato)</label>
                        <input type="text" id="buscaInputGeral" oninput="aplicarFiltrosGerais()" placeholder="Buscar por nome ou telefone..." 
                               class="w-full p-2 border border-gray-300 rounded-md text-sm focus:ring-indigo-500 focus:border-indigo-500">
                    </div>
                    <div>
                        <label class="block text-xs font-semibold text-gray-500 uppercase mb-1">Filtro por Tipo</label>
                        <select id="filtroTipoPessoa" onchange="aplicarFiltrosGerais()" class="w-full p-2 border border-gray-300 rounded-md text-sm focus:ring-indigo-500 bg-gray-100 font-medium">
                            <option value="">TODOS (Visitantes e Membros)</option>
                            <option value="Visitante">Somente Visitantes</option>
                            <option value="Membro">Somente Membros</option>
                        </select>
                    </div>
                </div>
                
                <div class="overflow-x-auto">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Tipo</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Nome / Contato</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Detalhes</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Data</th>
                            </tr>
                        </thead>
                        <tbody id="tabelaCorpoGeral" class="bg-white divide-y divide-gray-200"></tbody>
                    </table>
                    <div id="loadingHistoricoGeral" class="text-center py-4 text-gray-500 hidden">Carregando dados...</div>
                    <div id="semResultadosGeral" class="text-center py-4 text-gray-500 hidden">Nenhuma pessoa encontrada com esse filtro.</div>
                </div>
                <div class="mt-4 text-right text-xs text-gray-400">
                    Pessoas listadas: <span id="contadorTotalGeral" class="font-bold text-gray-700">0</span>
                </div>
            </div>
        </div>
    </div>


    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";
        import { getAuth, signInAnonymously } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-auth.js";
        import { getFirestore, collection, addDoc, getDocs, query, orderBy } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-firestore.js";

        // CONFIGURA√á√ÉO DO FIREBASE (MANTIDA)
        const firebaseConfig = {
            apiKey: "AIzaSyBpsd7fK3p6SOavvVUxCVkAoU_KKSMHXX0",
            authDomain: "visitantes-tf.firebaseapp.com",
            projectId: "visitantes-tf",
            storageBucket: "visitantes-tf.firebasestorage.app",
            messagingSenderId: "662740182528",
            appId: "1:662740182528:web:eeada0fd13ca09148adae5"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);

        // VARI√ÅVEIS GLOBAIS
        let todosRegistros = []; // Armazena Visitantes E Membros
        
        // --- FUN√á√ïES DE INTERFACE (ABAS) ---
        window.switchTab = function(tabName) {
            document.querySelectorAll('.tab-content').forEach(el => {
                el.classList.remove('active');
                el.classList.add('hidden');
            });
            
            document.querySelectorAll('button[id^="tab-"]').forEach(btn => {
                btn.className = "flex-1 py-2 px-4 rounded-md text-sm font-medium text-gray-500 hover:text-gray-700 transition-colors cursor-pointer";
            });
            
            const activeBtn = document.getElementById(`tab-${tabName}`);
            // Define a cor de fundo com base no tipo de aba
            let bgColor = 'bg-indigo-100 text-indigo-700';
            if (tabName === 'cadastroMembro') {
                bgColor = 'bg-green-100 text-green-700';
            } else if (tabName === 'historicoGeral') {
                bgColor = 'bg-gray-200 text-gray-700';
            }
            activeBtn.className = `flex-1 py-2 px-4 rounded-md text-sm font-medium ${bgColor} transition-colors cursor-pointer shadow-sm`;
            
            const activeView = document.getElementById(`view-${tabName}`);
            activeView.classList.remove('hidden');
            activeView.classList.add('active');

            // Carregamento de dados espec√≠ficos para abas de hist√≥rico
            if(['historicoVisitantes', 'historicoGeral'].includes(tabName)) {
                // Ao mudar para as abas de hist√≥rico, tentamos carregar, mas a l√≥gica de filtro
                // garantir√° que nada seja exibido se a igreja n√£o for selecionada.
                carregarHistoricoGeral(); 
            }
        };

        // --- AUTENTICA√á√ÉO ---
        async function authenticate() {
            try {
                await signInAnonymously(auth);
                console.log("Auth OK");
            } catch (error) {
                console.error("Erro Auth:", error);
            }
        }

        // --- FUN√á√ÉO GEN√âRICA DE SUBMISS√ÉO (REUTILIZADA) ---
        async function submitForm(formId, data, type) {
            const form = document.getElementById(formId);
            const submitButton = document.getElementById(`submitButton${type}`);
            const loader = document.getElementById(`loader${type}`);
            const feedbackMessage = document.getElementById(`feedbackMessage${type}`);

            submitButton.disabled = true;
            loader.style.display = 'block';
            feedbackMessage.classList.add('hidden');

            try {
                await addDoc(collection(db, "visitantes"), data); // Usando a mesma cole√ß√£o
                
                feedbackMessage.textContent = `üéâ Cadastro de ${type.toLowerCase()} realizado com sucesso!`;
                feedbackMessage.className = `p-3 rounded-md text-sm text-center font-medium bg-${type === 'Visitante' ? 'indigo' : 'green'}-100 text-${type === 'Visitante' ? 'indigo' : 'green'}-700 block mt-4`;
                form.reset();
            } catch (error) {
                console.error(error);
                feedbackMessage.textContent = `‚ùå Erro ao salvar o ${type.toLowerCase()}. Tente novamente.`;
                feedbackMessage.className = "p-3 rounded-md text-sm text-center font-medium bg-red-100 text-red-700 block mt-4";
            } finally {
                submitButton.disabled = false;
                loader.style.display = 'none';
                setTimeout(() => feedbackMessage.classList.add('hidden'), 5000);
            }
        }

        // --- ENVIO DO FORMUL√ÅRIO DE VISITANTE ---
        document.getElementById('formularioVisitante').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const igrejaEl = document.querySelector('input[name="igreja_visitante"]:checked'); // NOVO: Igreja
            const sexoEl = document.querySelector('input[name="sexo_visitante"]:checked');
            const faixaEl = document.querySelector('input[name="faixa_etaria_visitante"]:checked');
            const visitaEl = document.querySelector('input[name="receber_visita_visitante"]:checked');

            if (!igrejaEl) {
                alert("Por favor, selecione a Igreja de Lota√ß√£o do Visitante.");
                return;
            }

            const dados = {
                tipo: "Visitante",
                igreja: igrejaEl.value, // NOVO: Salva a Igreja
                nome: document.getElementById('nome_visitante').value.trim(),
                telefone: document.getElementById('telefone_visitante').value.trim(),
                endereco: document.getElementById('endereco_visitante').value.trim() || "N√£o informado",
                sexo: sexoEl ? sexoEl.value : "N√£o informado",
                convidadoPor: document.getElementById('convidado_por_visitante').value.trim() || "N√£o informado",
                faixaEtaria: faixaEl ? faixaEl.value : "N√£o Informada",
                receberVisita: visitaEl ? visitaEl.value : "N√£o informado",
                experiencia: document.getElementById('experiencia_visitante').value.trim() || "Sem coment√°rio",
                dataRegistro: new Date().toISOString()
            };
            
            submitForm('formularioVisitante', dados, 'Visitante');
        });

        // --- ENVIO DO FORMUL√ÅRIO DE MEMBRO ---
        document.getElementById('formularioMembro').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const igrejaEl = document.querySelector('input[name="igreja_membro"]:checked'); // NOVO: Igreja
            const sexoEl = document.querySelector('input[name="sexo_membro"]:checked');
            const faixaEl = document.querySelector('input[name="faixa_etaria_membro"]:checked');
            const grupoEl = document.querySelector('input[name="grupo_assistencia_membro"]:checked');

            if (!igrejaEl) {
                alert("Por favor, selecione a Igreja de Lota√ß√£o do Membro.");
                return;
            }

            const dados = {
                tipo: "Membro", 
                igreja: igrejaEl.value, // NOVO: Salva a Igreja
                nome: document.getElementById('nome_membro').value.trim(),
                telefone: "N/A - Cadastro Membro", 
                endereco: "Membro", 
                sexo: sexoEl ? sexoEl.value : "N√£o informado",
                faixaEtaria: faixaEl ? faixaEl.value : "N√£o Informada", 
                funcao: document.getElementById('funcao_membro').value.trim() || "N√£o informado",
                grupoAssistencia: grupoEl ? grupoEl.value : "N√£o informado", 
                dataRegistro: new Date().toISOString()
            };
            
            submitForm('formularioMembro', dados, 'Membro');
        });

        // --- L√ìGICA DO HIST√ìRICO GERAL (Nova Aba) ---
        
        window.carregarHistoricoGeral = async function() {
            const fIgreja = document.querySelector('input[name="filtro_igreja_geral"]:checked')?.value;
            const loading = document.getElementById('loadingHistoricoGeral');
            const conteudo = document.getElementById('conteudoHistoricoGeral');
            const aviso = document.getElementById('avisoIgrejaGeral');
            const tbodyGeral = document.getElementById('tabelaCorpoGeral');

            if (!fIgreja) {
                aviso.classList.remove('hidden');
                conteudo.classList.add('hidden');
                tbodyGeral.innerHTML = '';
                // Zera os totais quando n√£o h√° igreja selecionada
                document.getElementById('totalVisitantes').textContent = 0;
                document.getElementById('totalMembros').textContent = 0;
                document.getElementById('totalGeral').textContent = 0;
                return;
            }
            
            aviso.classList.add('hidden');
            conteudo.classList.remove('hidden');
            loading.classList.remove('hidden');
            tbodyGeral.innerHTML = '';


            try {
                const q = query(collection(db, "visitantes"), orderBy("dataRegistro", "desc"));
                const querySnapshot = await getDocs(q);
                
                // Carrega todos os registros
                todosRegistros = [];
                querySnapshot.forEach((doc) => {
                    todosRegistros.push(doc.data());
                });
                
                // Filtra pelo valor da igreja selecionada
                const registrosFiltradosPorIgreja = todosRegistros.filter(r => r.igreja === fIgreja);

                // 1. Atualiza Totais
                const totalVisitantesCount = registrosFiltradosPorIgreja.filter(r => r.tipo === 'Visitante').length;
                const totalMembrosCount = registrosFiltradosPorIgreja.filter(r => r.tipo === 'Membro').length;
                const totalGeralCount = registrosFiltradosPorIgreja.length;

                document.getElementById('totalVisitantes').textContent = totalVisitantesCount;
                document.getElementById('totalMembros').textContent = totalMembrosCount;
                document.getElementById('totalGeral').textContent = totalGeralCount;

                // 2. Aplica Filtros e Renderiza Tabela, PASSANDO A LISTA J√Å FILTRADA PELA IGREJA
                aplicarFiltrosGerais(registrosFiltradosPorIgreja);
                carregarHistoricoVisitantes(); // Chama o carregamento de visitantes que usar√° a mesma lista global filtrada
                
            } catch (error) {
                console.error("Erro ao buscar hist√≥rico geral:", error);
                if (tbodyGeral) tbodyGeral.innerHTML = `<tr><td colspan="4" class="text-center py-4 text-red-500">Erro ao carregar dados.</td></tr>`;
            } finally {
                if (loading) loading.classList.add('hidden');
            }
        }

        // CORRIGIDA: A lista inicial agora √© a lista filtrada pela igreja, e o filtro de Tipo √© aplicado sobre ela.
        window.aplicarFiltrosGerais = function(listaInicialIgreja) {
            // Se listaInicialIgreja n√£o for fornecida (ex: chamada pelo oninput), a recriamos
            if (!listaInicialIgreja) {
                 const fIgreja = document.querySelector('input[name="filtro_igreja_geral"]:checked')?.value;
                 if (!fIgreja) return; // Se n√£o houver igreja, n√£o faz nada
                 listaInicialIgreja = todosRegistros.filter(r => r.igreja === fIgreja);
            }

            const termoBusca = document.getElementById('buscaInputGeral').value.toLowerCase().trim();
            const fTipo = document.getElementById('filtroTipoPessoa').value;
            
            // Usa listaInicialIgreja (j√° filtrada por Igreja) como base
            const filtrados = listaInicialIgreja.filter(r => {
                const nomeStr = (r.nome || "").toLowerCase();
                const telefoneStr = (r.telefone || "").toLowerCase();
                
                const matchBusca = termoBusca === "" || nomeStr.includes(termoBusca) || (r.tipo === 'Visitante' && telefoneStr.includes(termoBusca)); 
                const matchTipo = fTipo === "" || r.tipo === fTipo;
                
                return matchBusca && matchTipo;
            });

            renderizarTabelaGeral(filtrados);
        }

        function renderizarTabelaGeral(lista) {
            const tbody = document.getElementById('tabelaCorpoGeral');
            const semResultados = document.getElementById('semResultadosGeral');
            const contador = document.getElementById('contadorTotalGeral');
            
            tbody.innerHTML = '';
            contador.textContent = lista.length;

            if (lista.length === 0) {
                semResultados.classList.remove('hidden');
                return;
            } else {
                semResultados.classList.add('hidden');
            }

            lista.forEach(r => {
                const dataObj = r.dataRegistro ? new Date(r.dataRegistro) : new Date();
                const dataFormatada = dataObj.toLocaleDateString('pt-BR');
                
                let tipoBadge, detalhes, contatoDisplay;

                if (r.tipo === 'Visitante') {
                    tipoBadge = '<span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-blue-100 text-blue-800">Visitante</span>';
                    const visitaBadge = r.receberVisita === 'Sim' ? '<span class="text-[10px] text-green-700 ml-1">üè† Visita</span>' : '';
                    detalhes = `<span class="text-xs text-gray-600">Convidado por: ${r.convidadoPor || '-'}</span>${visitaBadge}`;
                    contatoDisplay = r.telefone || '-';
                } else { // Membro
                    tipoBadge = '<span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800">Membro</span>';
                    // Detalhes do Membro ATUALIZADOS
                    let infoAdicional = `Fun√ß√£o: ${r.funcao || '-'}`;
                    if (r.grupoAssistencia && r.grupoAssistencia !== 'N√£o informado') {
                        infoAdicional += ` | Grupo: ${r.grupoAssistencia}`; 
                    }
                    detalhes = `<span class="text-xs text-gray-600">${infoAdicional}</span>`;
                    contatoDisplay = 'N/A';
                }

                const tr = document.createElement('tr');
                tr.className = r.tipo === 'Membro' ? 'hover:bg-green-50' : 'hover:bg-blue-50';
                tr.innerHTML = `
                    <td class="px-4 py-3 whitespace-nowrap">${tipoBadge}</td>
                    <td class="px-4 py-3">
                        <div class="text-sm font-medium text-gray-900">${r.nome}</div>
                        <div class="text-xs text-gray-500">${contatoDisplay}</div>
                    </td>
                    <td class="px-4 py-3">${detalhes}</td>
                    <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-500">${dataFormatada}</td>
                `;
                tbody.appendChild(tr);
            });
        }
        
        // --- L√ìGICA DO HIST√ìRICO VISITANTES ---

        window.carregarHistoricoVisitantes = function() {
            const fIgreja = document.querySelector('input[name="filtro_igreja_visitante"]:checked')?.value;
            const conteudo = document.getElementById('conteudoHistoricoVisitante');
            const aviso = document.getElementById('avisoIgrejaVisitante');
            const tbodyVisitantes = document.getElementById('tabelaCorpoVisitantes');

            if (!fIgreja) {
                aviso.classList.remove('hidden');
                conteudo.classList.add('hidden');
                tbodyVisitantes.innerHTML = '';
                document.getElementById('contadorTotalVisitantes').textContent = 0;
                return;
            }
            
            aviso.classList.add('hidden');
            conteudo.classList.remove('hidden');

            // Filtra a lista global (j√° carregada pelo carregarHistoricoGeral) para obter apenas visitantes da igreja selecionada
            const visitantes = todosRegistros.filter(r => r.tipo === 'Visitante' && r.igreja === fIgreja);
            
            const selectMembro = document.getElementById('filtroMembro');
            const membrosSet = new Set();
            visitantes.forEach(v => {
                if(v.convidadoPor && v.convidadoPor !== "N√£o informado") {
                    membrosSet.add(v.convidadoPor.trim());
                }
            });

            // Popula o filtro "Convidado Por"
            selectMembro.innerHTML = '<option value="">Todos os Membros</option>';
            Array.from(membrosSet).sort().forEach(membro => {
                const option = document.createElement('option');
                option.value = membro;
                option.textContent = membro;
                selectMembro.appendChild(option);
            });

            aplicarFiltrosVisitantes(visitantes);
        }

        window.aplicarFiltrosVisitantes = function(listaInicialIgrejaVisitante) {
            const fIgreja = document.querySelector('input[name="filtro_igreja_visitante"]:checked')?.value;
            if (!fIgreja) return; // Nao executa se a igreja nao estiver selecionada

            // Se a lista n√£o for passada (ex: chamada pelo oninput), a recriamos
            if (!listaInicialIgrejaVisitante) {
                listaInicialIgrejaVisitante = todosRegistros.filter(r => r.tipo === 'Visitante' && r.igreja === fIgreja);
            }

            // A listaInicialIgrejaVisitante j√° est√° filtrada por tipo e igreja. Usamos ela como base.
            
            const fMembro = document.getElementById('filtroMembro').value.toLowerCase();
            const fIdade = document.getElementById('filtroIdade').value;
            const fSexo = document.getElementById('filtroSexoVisitante').value;
            const termoBusca = document.getElementById('buscaInputVisitante').value.toLowerCase().trim();
            const fVisita = document.getElementById('filtroVisita').value;

            const filtrados = listaInicialIgrejaVisitante.filter(v => {
                const nomeStr = v.nome ? v.nome.toLowerCase() : "";
                const enderecoStr = v.endereco ? v.endereco.toLowerCase() : "";
                
                const matchBusca = termoBusca === "" || nomeStr.includes(termoBusca) || enderecoStr.includes(termoBusca);
                const matchMembro = fMembro === "" || (v.convidadoPor && v.convidadoPor.toLowerCase().includes(fMembro));
                const matchIdade = fIdade === "" || v.faixaEtaria === fIdade;
                const matchSexo = fSexo === "" || v.sexo === fSexo;
                const matchVisita = fVisita === "" || v.receberVisita === fVisita;
                
                return matchBusca && matchMembro && matchIdade && matchSexo && matchVisita;
            });

            renderizarTabelaVisitantes(filtrados);
        }

        function renderizarTabelaVisitantes(lista) {
            const tbody = document.getElementById('tabelaCorpoVisitantes');
            const semResultados = document.getElementById('semResultadosVisitantes');
            const contador = document.getElementById('contadorTotalVisitantes');
            
            tbody.innerHTML = '';
            contador.textContent = lista.length;

            if (lista.length === 0) {
                semResultados.classList.remove('hidden');
                return;
            } else {
                semResultados.classList.add('hidden');
            }

            lista.forEach(v => {
                const corBadge = v.sexo === 'Masculino' ? 'bg-blue-100 text-blue-800' : (v.sexo === 'Feminino' ? 'bg-pink-100 text-pink-800' : 'bg-gray-100 text-gray-800');
                
                // C√ìDIGO para a coluna Visita?
                let visitaContent;
                if (v.receberVisita === 'Sim') {
                    visitaContent = '<span class="px-2 py-1 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800">‚úÖ Sim</span>';
                } else {
                    visitaContent = '<span class="px-2 py-1 inline-flex text-xs leading-5 font-semibold rounded-full bg-red-100 text-red-800">‚ùå N√£o</span>';
                }

                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td class="px-4 py-3">
                        <div class="text-sm font-medium text-gray-900">${v.nome}</div>
                        <div class="text-xs text-gray-500">${v.telefone || '-'}</div>
                    </td>
                    <td class="px-4 py-3 text-sm text-gray-500">${v.endereco || 'N√£o informado'}</td>
                    <td class="px-4 py-3 whitespace-nowrap">
                         <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${corBadge}">
                            ${v.sexo || '?'}
                        </span>
                        <div class="text-xs text-gray-500 mt-1">${v.faixaEtaria}</div>
                    </td>
                    <td class="px-4 py-3 whitespace-nowrap text-sm">
                        ${visitaContent}
                    </td>
                    <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-400">
                        ${v.convidadoPor}
                    </td>
                `;
                tbody.appendChild(tr);
            });
        }
        
        // Event Listeners da Aba Hist√≥rico Visitantes
        document.getElementById('buscaInputVisitante').addEventListener('input', aplicarFiltrosVisitantes);
        document.getElementById('filtroMembro').addEventListener('change', aplicarFiltrosVisitantes);
        document.getElementById('filtroIdade').addEventListener('change', aplicarFiltrosVisitantes);
        document.getElementById('filtroSexoVisitante').addEventListener('change', aplicarFiltrosVisitantes);
        document.getElementById('filtroVisita').addEventListener('change', aplicarFiltrosVisitantes);

        // Event Listeners da Aba Hist√≥rico Geral
        document.getElementById('buscaInputGeral').addEventListener('input', aplicarFiltrosGerais);
        document.getElementById('filtroTipoPessoa').addEventListener('change', aplicarFiltrosGerais);
        
        // Inicializa√ß√£o
        document.addEventListener('DOMContentLoaded', () => {
            authenticate();
            // Nenhuma chamada para carregarHistoricoGeral() aqui.
            // O carregamento inicial ser√° acionado apenas ao selecionar a igreja na aba de hist√≥rico.
        });

    </script>
</body>
</html>
